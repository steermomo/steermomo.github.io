<!DOCTYPE html>
<html lang="en">

<head>
        <meta name="google-site-verification" content="d0pvXqLPH8JyCfWVyhZ7njhGUndRFIR95YM3myMb7rU" />
        <meta charset="utf-8" />
        <meta http-equiv="Cache-Control" content="no-transform" />
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes" />
        <title>GCP console 创建VM</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
        <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


        <link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css">

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <!-- <h1><a href="/">steer </a></h1> -->
                <nav>
                        <ul>
                                <li><a href="/">🦉</a></li>
                                <li><a href="/blog">Blog</a></li>
                                <li><a href="/archives">Archives</a></li>
                                <li><a href="/gallery">Gallery</a></li>
                                <li id="navName">steer </li>
                        </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/blog/2019/09/gcp-console-chuang-jian-vm" rel="bookmark" title="Permalink to GCP console 创建VM">GCP console 创建VM</a>
      </h1>
    </header>

    <div class="entry-content">
<div class="post-meta">
        Date: <span >
               2019-09-18 Wed
        </span>
<span>Category: <a href="/category/gcp/">GCP</a></span>
<!-- <p>tags: <a href="/tags/gcp/">GCP</a> </p> -->

</div><!-- /.post-info -->

      <p>命令根据<a href="https://course.fast.ai/start_gcp.html">fastai GCP setup</a>, 并针对我的任务进行了修改。</p>
<p>Google Cloud’s command line interface (CLI)安装配置部分见<a href="https://course.fast.ai/start_gcp.html">fastai GCP setup</a></p>
<p>另外因为火星网络环境不够稳定, 我在wsl中配置了proxychains4, 连到Windows主机的sock5代理.</p>
<p>创建抢占式实例</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">IMAGE_FAMILY</span><span class="o">=</span><span class="s2">&quot;pytorch-latest-gpu&quot;</span><span class="w"> </span><span class="c1"># or &quot;pytorch-latest-cpu&quot; for non-GPU instances</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ZONE</span><span class="o">=</span><span class="s2">&quot;asia-southeast1-b&quot;</span><span class="w"> </span><span class="c1"># budget: &quot;us-west1-b&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">INSTANCE_NAME</span><span class="o">=</span><span class="s2">&quot;kaggle-rsna&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">INSTANCE_TYPE</span><span class="o">=</span><span class="s2">&quot;n1-highmem-8&quot;</span><span class="w"> </span><span class="c1"># budget: &quot;n1-highmem-4&quot;</span>

<span class="c1"># budget: &#39;type=nvidia-tesla-k80,count=1&#39;</span>
proxychains4<span class="w"> </span>gcloud<span class="w"> </span>compute<span class="w"> </span>instances<span class="w"> </span>create<span class="w"> </span><span class="nv">$INSTANCE_NAME</span><span class="w"> </span>--zone<span class="o">=</span><span class="nv">$ZONE</span><span class="w"> </span>--image-family<span class="o">=</span><span class="nv">$IMAGE_FAMILY</span><span class="w"> </span>--image-project<span class="o">=</span>deeplearning-platform-release<span class="w"> </span>--maintenance-policy<span class="o">=</span>TERMINATE<span class="w">  </span>--accelerator<span class="o">=</span><span class="s2">&quot;type=nvidia-tesla-p4,count=1&quot;</span><span class="w">  </span>--machine-type<span class="o">=</span><span class="nv">$INSTANCE_TYPE</span><span class="w">  </span>--boot-disk-size<span class="o">=</span>800GB<span class="w"> </span>--metadata<span class="o">=</span><span class="s2">&quot;install-nvidia-driver=True&quot;</span><span class="w"> </span>--preemptible
</code></pre></div>

<p>创建完成之后, ssh连接上去并开启端口转发, 创建的主机默认有<code>jupyter</code>用户, 并且在<code>8080</code>端口开了jupyter lab. 这里就用<code>jupyter</code>用户连上去, 并开启本地端口转发.</p>
<div class="highlight"><pre><span></span><code>proxychains4<span class="w"> </span>gcloud<span class="w"> </span>beta<span class="w"> </span>compute<span class="w"> </span>--project<span class="w"> </span><span class="s2">&quot;limongty&quot;</span><span class="w"> </span>ssh<span class="w"> </span>--zone<span class="w"> </span><span class="s2">&quot;asia-southeast1-b&quot;</span><span class="w"> </span>jupyter@<span class="s2">&quot;kaggle-rsna&quot;</span><span class="w"> </span>--<span class="w"> </span>-L<span class="w"> </span><span class="m">8080</span>:localhost:8080
</code></pre></div>

<p>连接成功后本地浏览器打开<code>localhost:8080</code>可以使用远程环境.</p>
    </div><!-- /.entry-content -->


  </article>


</section>

<div id="comments">
  <h2 style="margin-top: 0.1rem;">Comments !</h2>
  <div id="gitalk-container"></div>
</div>
<script>
  var gitalk = new Gitalk({
    clientID: '4dfbf5aad180623dc634',
    clientSecret: '4c7167883746062103d9dbc2ec8b1ddfd6780d58',
    repo: 'steermomo.github.io',
    owner: 'steermomo',
    admin: ['steermomo'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false,  // Facebook-like distraction free mode
    createIssueManually: true,
  })
  gitalk.render('gitalk-container')
</script>
        <section id="extras" class="body">
        </section><!-- /#extras -->
<footer id="contentinfo" class="body">
  <address id="about" class="vcard body">
    Copyright © 2024
    </br>
    Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a
      href="http://python.org">Python</a>.
  </address>

  <!-- /#about -->


</footer><!-- /#contentinfo -->



</body>

</html>