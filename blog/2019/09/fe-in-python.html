<!DOCTYPE html>
<html lang="en">

<head>
        <meta name="google-site-verification" content="d0pvXqLPH8JyCfWVyhZ7njhGUndRFIR95YM3myMb7rU" />
        <meta charset="utf-8" />
        <meta http-equiv="Cache-Control" content="no-transform" />
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes" />
        <title>Feature Engineering for Machine Learning in Python</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
        <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


        <link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css">

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <!-- <h1><a href="/">steer </a></h1> -->
                <nav>
                        <ul>
                                <li><a href="/">🦉</a></li>
                                <li><a href="/blog">Blog</a></li>
                                <li><a href="/archives">Archives</a></li>
                                <li><a href="/gallery">Gallery</a></li>
                                <li id="navName">steer </li>
                        </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/blog/2019/09/fe-in-python" rel="bookmark" title="Permalink to Feature Engineering for Machine Learning in Python">Feature Engineering for Machine Learning in Python</a>
      </h1>
    </header>

    <div class="entry-content">
<div class="post-meta">
        Date: <span >
               2019-09-03 Tue
        </span>
<span>Category: <a href="/category/misc/">misc</a></span>
<!-- <p>tags: <a href="/tags/dns/">DNS</a> <a href="/tags/cname/">CNAME</a> <a href="/tags/namecheap/">namecheap</a> </p> -->

</div><!-- /.post-info -->

      <p>嚯嚯嚯</p>
<p><br></p>
<h3>Chapter 1, 'Creating Features'.</h3>
<p><br></p>
<h3>Selecting specific data types</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create subset of only the numeric columns</span>
<span class="n">so_numeric_df</span> <span class="o">=</span> <span class="n">so_survey_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">])</span>

<span class="c1"># Print the column names contained in so_survey_df_num</span>
<span class="nb">print</span><span class="p">(</span><span class="n">so_numeric_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</code></pre></div>

<p><br></p>
<h3>Dealing with categorical features</h3>
<ul>
<li>One-hot encoding<ul>
<li>n features for n categories</li>
<li>Explainable</li>
</ul>
</li>
<li>Dummy encoding<ul>
<li>n-1 features for n categories</li>
<li>Necessary information</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># One hot</span>
<span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>

<span class="c1"># Dummy</span>
<span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Limiting columns</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 将出现次数少于10次的国家归入Other</span>
<span class="c1"># Create a series out of the Country column</span>
<span class="n">countries</span> <span class="o">=</span> <span class="n">so_survey_df</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span>

<span class="c1"># Get the counts of each category</span>
<span class="n">country_counts</span> <span class="o">=</span> <span class="n">countries</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

<span class="c1"># Create a mask for only categories that occur less than 10 times</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">countries</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">country_counts</span><span class="p">[</span><span class="n">country_counts</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># Label all other categories as Other</span>
<span class="n">countries</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Other&#39;</span>

<span class="c1"># Print the updated category counts</span>
<span class="nb">print</span><span class="p">(</span><span class="n">countries</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</code></pre></div>

<p><br></p>
<h3>Numeric variables</h3>
<ul>
<li>Binarizing columns</li>
<li>Bining numeric variables</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 等间距cut</span>
<span class="n">so_survey_df</span><span class="p">[</span><span class="s1">&#39;equal_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">so_survey_df</span><span class="p">[</span><span class="s1">&#39;ConvertedSalary&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># 指定边界cut</span>
<span class="c1"># Import numpy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Specify the boundaries of the bins</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">150000</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>

<span class="c1"># Bin labels</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Very low&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s1">&#39;Very high&#39;</span><span class="p">]</span>

<span class="c1"># Bin the continuous variable ConvertedSalary using these boundaries</span>
<span class="n">so_survey_df</span><span class="p">[</span><span class="s1">&#39;boundary_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">so_survey_df</span><span class="p">[</span><span class="s1">&#39;ConvertedSalary&#39;</span><span class="p">],</span> 
                                         <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

<span class="c1"># Print the first 5 rows of the boundary_binned column</span>
<span class="nb">print</span><span class="p">(</span><span class="n">so_survey_df</span><span class="p">[[</span><span class="s1">&#39;boundary_binned&#39;</span><span class="p">,</span> <span class="s1">&#39;ConvertedSalary&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>

<p><br></p>
<h3>Missing data</h3>
<p><br>
Listwise deletion</p>
<div class="highlight"><pre><span></span><code><span class="c1"># drop row at least one na</span>
<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>

<span class="c1"># drop specific columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[])</span>
</code></pre></div>

<p><br></p>
<p>Fillna</p>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="s1">&#39;xxx&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<p><br>
Fill continuous missing values</p>
<ul>
<li>Mean</li>
<li>Median</li>
</ul>
<p><br></p>
<h3>Dealing with other data issues</h3>
<p>Bad character
- Numeric column has nan or other characters
- convert data type
- use isna find stray characters</p>
<p><br>
Data distributions
<img alt="image.png" src="http://ww1.sinaimg.cn/large/dd456925gy1g6nw890s5ej20jb0adgmd.jpg"></p>
<div class="highlight"><pre><span></span><code><span class="c1"># box plot</span>
<span class="c1"># Create a boxplot of two columns</span>
<span class="n">so_numeric_df</span><span class="p">[[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Years Experience&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1">#</span>
</code></pre></div>

<p><br></p>
<h3>Scaling and transformations</h3>
<p>长尾数据使用log变换</p>
<p><br></p>
<h3>Removing outliers</h3>
<p>Use quantile</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Find the 95th quantile</span>
<span class="n">quantile</span> <span class="o">=</span> <span class="n">so_numeric_df</span><span class="p">[</span><span class="s1">&#39;ConvertedSalary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)</span>

<span class="c1"># Trim the outliers</span>
<span class="n">trimmed_df</span> <span class="o">=</span> <span class="n">so_numeric_df</span><span class="p">[</span><span class="n">so_numeric_df</span><span class="p">[</span><span class="s1">&#39;ConvertedSalary&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">quantile</span><span class="p">]</span>
</code></pre></div>

<p><br></p>
<h3>Scaling and transforming new data</h3>
<p>Don't use test data. Avoid data leakage.</p>
<p><br></p>
<h3>Encoding text</h3>
<p>clean text</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Replace all non letter characters with a whitespace</span>
<span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;text_clean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[^a-zA-Z]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>

<span class="c1"># Change to lower case</span>
<span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;text_clean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;text_clean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="c1"># Print the first 5 rows of the text_clean column</span>
<span class="nb">print</span><span class="p">(</span><span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;text_clean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>

<p><br>
Heigh level feature</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Find the length of each text</span>
<span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;char_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;text_clean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>

<span class="c1"># Count the number of words in each text</span>
<span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;word_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;text_clean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>

<span class="c1"># Find the average length of word</span>
<span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;avg_word_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">speech_df</span><span class="o">.</span><span class="n">char_cnt</span> <span class="o">/</span> <span class="n">speech_df</span><span class="o">.</span><span class="n">word_cnt</span>

<span class="c1"># Print the first 5 rows of these columns</span>
<span class="nb">print</span><span class="p">(</span><span class="n">speech_df</span><span class="p">[[</span><span class="s1">&#39;text_clean&#39;</span><span class="p">,</span> <span class="s1">&#39;char_cnt&#39;</span><span class="p">,</span> <span class="s1">&#39;word_cnt&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_word_length&#39;</span><span class="p">]])</span>
</code></pre></div>

<p><br>
Word count</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Import CountVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="c1"># Instantiate CountVectorizer</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">()</span>

<span class="c1"># Fit the vectorizer</span>
<span class="n">cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">speech_df</span><span class="p">[</span><span class="s1">&#39;text_clean&#39;</span><span class="p">])</span>

<span class="c1"># Print feature names</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">())</span>
</code></pre></div>

<p><br></p>
<h3>Term frequency-inverse document frequency</h3>
<p>这部分都不太想看了... 用不到的时候就会忘记 </p>
    </div><!-- /.entry-content -->


  </article>


</section>

<div id="comments">
  <h2 style="margin-top: 0.1rem;">Comments !</h2>
  <div id="gitalk-container"></div>
</div>
<script>
  var gitalk = new Gitalk({
    clientID: '4dfbf5aad180623dc634',
    clientSecret: '4c7167883746062103d9dbc2ec8b1ddfd6780d58',
    repo: 'steermomo.github.io',
    owner: 'steermomo',
    admin: ['steermomo'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false,  // Facebook-like distraction free mode
    createIssueManually: true,
  })
  gitalk.render('gitalk-container')
</script>
        <section id="extras" class="body">
        </section><!-- /#extras -->
<footer id="contentinfo" class="body">
  <address id="about" class="vcard body">
    Copyright © 2024
    </br>
    Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a
      href="http://python.org">Python</a>.
  </address>

  <!-- /#about -->


</footer><!-- /#contentinfo -->



</body>

</html>