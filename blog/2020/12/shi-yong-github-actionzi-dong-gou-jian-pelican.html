<!DOCTYPE html>
<html lang="en">

<head>
        <meta name="google-site-verification" content="d0pvXqLPH8JyCfWVyhZ7njhGUndRFIR95YM3myMb7rU" />
        <meta charset="utf-8" />
        <meta http-equiv="Cache-Control" content="no-transform" />
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes" />
        <title>ä½¿ç”¨Github Actionè‡ªåŠ¨æ„å»ºPelican</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
        <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


        <link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css">

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <!-- <h1><a href="/">steer </a></h1> -->
                <nav>
                        <ul>
                                <li><a href="/">ğŸ¦‰</a></li>
                                <li><a href="/blog">Blog</a></li>
                                <li><a href="/archives">Archives</a></li>
                                <li><a href="/gallery">Gallery</a></li>
                                <li id="navName">steer </li>
                        </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/blog/2020/12/shi-yong-github-actionzi-dong-gou-jian-pelican" rel="bookmark" title="Permalink to ä½¿ç”¨Github Actionè‡ªåŠ¨æ„å»ºPelican">ä½¿ç”¨Github Actionè‡ªåŠ¨æ„å»ºPelican</a>
      </h1>
    </header>

    <div class="entry-content">
<div class="post-meta">
        Date: <span >
               2020-12-22 Tue
        </span>
<span>Category: <a href="/category/python/">Python</a></span>
<!-- <p>tags: <a href="/tags/pelican/">pelican</a> <a href="/tags/publishing/">publishing</a> </p> -->

</div><!-- /.post-info -->

      <p>æˆ‘è‡ªå·±åœ¨åšå®¢çš„éƒ¨ç½²ä¸Šï¼Œå¤§è‡´ç»å†äº†ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>Wordpress</li>
<li>Hexo</li>
<li>Pelican + Travis</li>
<li>Pelican + Github Action</li>
</ul>
<p>å¯¹æˆ‘æ¥è¯´ï¼ŒPelican + Github Actionæ˜¯é™æ€é¡µé¢éƒ¨ç½²çš„æœ€ä½³å®è·µã€‚</p>
<p>Wordpressçš„åŠŸèƒ½å¯¹æˆ‘æ¥è¯´æœ‰äº›å¤ªå¤šäº†ï¼Œæœ‰äº›ç¹é‡ï¼Œæˆ‘åªéœ€è¦ä¸€ä¸ªé™æ€çš„é¡µé¢æ‰˜ç®¡ä¸€äº›æƒ³æ³•å°±å¤Ÿäº†ã€‚åœ¨WPä¹‹åä½¿ç”¨äº†Hexoï¼Œæœ¬åœ°ç”Ÿæˆé¡µé¢åæ¨é€åˆ°Github Pagesåˆ†æ”¯ä¸Šå»ï¼ŒHexoä»¤äººçƒ¦æ¼çš„æ˜¯<code>node_modules</code>ï¼Œè€Œä¸”ä¸€æ—¦æœ¬åœ°ä¸¢äº†æ–‡ä»¶æˆ–è€…æ¢ç¯å¢ƒéƒ¨ç½²å°±ç‰¹åˆ«éº»çƒ¦ã€‚åœ¨æŠ˜è…¾Hexoçš„è¿‡ç¨‹ä¸­ä¹Ÿçœ‹åˆ°æœ‰äººæƒ³åŠæ³•æ„å»ºäº†ç»¿è‰²ç‰ˆçš„nodeç¯å¢ƒæ”¾åœ¨ç§»åŠ¨å­˜å‚¨è®¾å¤‡ä¸­ï¼Œå®ç°ç¯å¢ƒçš„ç®€å•è¿ç§»ã€‚</p>
<p>è¿™ç§å°†æ•°æ®ä¸ç¯å¢ƒå°åœ¨ä¸€èµ·çš„åšæ³•è¿˜æ˜¯ä¸å¤Ÿç®€æ´ï¼Œåœ¨é‚£ä¹‹åæˆ‘å¼€å§‹ç”¨Pelicanã€‚åªè¦æœ‰å¯¹åº”çš„PythonåŒ…ç¯å¢ƒï¼Œå°±èƒ½ä¸€é”®ç¼–è¯‘å‡ºé™æ€é¡µé¢ï¼Œåªéœ€è¦æŒç»­ä¿ç•™åŸæ–‡æ¡£å³å¯ã€‚
ä¸ºäº†å°†åŸå§‹çš„æ–‡æ¡£å°†ç”Ÿæˆçš„é¡µé¢åˆ†ç¦»ï¼Œåˆç”¨äº†Traviså»åšæŒç»­é›†æˆã€‚Travisç›‘æ§å¹¶æ‹‰å»githubä¸Šçš„åˆ†æ”¯ï¼Œå°†ç¼–è¯‘åçš„æ–‡ä»¶æ¨é€åˆ°å¦å¤–ä¸€ä¸ªåˆ†æ”¯å†…ï¼Œä»¥æ­¤å®ç°åŸæ–‡æ¡£ä¸ç”Ÿæˆæ–‡ä»¶çš„åˆ†ç¦»ã€‚</p>
<p>Travisçš„ä¸€ä¸ªä¸å¤ªå®Œç¾çš„åœ°æ–¹å°±æ˜¯ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„ç½‘ç«™ã€‚åœ¨Github Actionæ¨å‡ºä¹‹åæˆ‘å°±ä¸€ç›´æƒ³å°†æŒç»­é›†æˆè¿ç§»åˆ°Githubè‡ªå¸¦çš„æœåŠ¡ä¸Šã€‚</p>
<h2>åˆ›å»ºWorkflow</h2>
<p>åœ¨é¡¹ç›®çš„é€‰é¡¹å¡ä¸­é€‰æ‹©<code>Action</code>ï¼Œç„¶åä½¿ç”¨<code>New workflow</code>ï¼Œåˆ›å»ºæ–°çš„CIæµç¨‹ï¼Œè¿™ä¸€æ­¥ä¼šåœ¨é¡¹ç›®çš„<code>.github/workflows</code>ä¸‹åˆ›å»º<code>.yml</code>æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚</p>
<h2>Workflowé…ç½®</h2>
<p>ä¸‹é¢è´´ä¸Šæˆ‘çš„CIé…ç½®ï¼Œå…³äºGithub Actionsçš„è¯´æ˜å¯ä»¥ç›´æ¥çœ‹<a href="https://docs.github.com/cn/free-pro-team@latest/actions">GitHub Actionsæ–‡æ¡£</a>æˆ–è€…<a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html">é˜®ä¸€å³°çš„GitHub Actions å…¥é—¨æ•™ç¨‹</a>ã€‚</p>
<p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹éœ€è¦æœ‰<code>requirements.txt</code>é…ç½®ç›¸å…³çš„åŒ…ä¾èµ–ï¼Œé…ç½®ä¸­çš„ <strong>Install dependencies</strong> è¿™ä¸€æ­¥ä¼šå®‰è£…ç›¸åº”çš„ä¾èµ–ï¼Œ<strong>Generate pages</strong> è¿™ä¸€æ­¥ä¼šè°ƒç”¨pelicançš„å‘½ä»¤è¡Œå°†é™æ€é¡µé¢ç”Ÿæˆåˆ°<code>output</code>ç›®å½•ä¸‹ï¼Œ<strong>Push content</strong> ä¼šåœ¨<code>output</code>è·¯å¾„ä¸‹åˆ›å»ºåˆå§‹åŒ–gitï¼Œ å¹¶å°†è¯¥è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ¨é€åˆ°gh-pagesåˆ†æ”¯ä¸‹ã€‚å¯¹gh-pagesè¿™ä¸€åˆ†æ”¯ï¼Œå¹¶æ²¡æœ‰å¿…è¦ä¿å­˜å†å²çš„commitï¼Œä½¿ç”¨forceå‘½ä»¤å¼ºåˆ¶è¦†ç›–è¿™ä¸€åˆ†æ”¯ã€‚</p>
<blockquote>
<p>--force</p>
<p>Usually, the command refuses to update a remote ref that is not an ancestor of the local ref used to overwrite it. Also, when --force-with-lease option is used, the command refuses to update a remote ref whose current value does not match what is expected.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp"># This workflow will install Python dependencies, run tests and lint with a single version of Python</span>
<span class="cp"># For more information see: https:</span><span class="c1">//help.github.com/actions/language-and-framework-guides/using-python-with-github-actions</span>

<span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">Python</span><span class="w"> </span><span class="n">application</span>

<span class="nl">on</span><span class="p">:</span>
<span class="w">  </span><span class="nl">push</span><span class="p">:</span>
<span class="w">    </span><span class="nl">branches</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="p">]</span>
<span class="w">  </span><span class="nl">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nl">branches</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="p">]</span>

<span class="nl">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nl">build</span><span class="p">:</span>

<span class="w">    </span><span class="n">runs</span><span class="o">-</span><span class="n">on</span><span class="o">:</span><span class="w"> </span><span class="n">ubuntu</span><span class="o">-</span><span class="n">latest</span>

<span class="w">    </span><span class="nl">steps</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">uses</span><span class="o">:</span><span class="w"> </span><span class="n">actions</span><span class="o">/</span><span class="n">checkout</span><span class="p">@</span><span class="n">v2</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">Python</span><span class="w"> </span><span class="mf">3.8</span>
<span class="w">      </span><span class="nl">uses</span><span class="p">:</span><span class="w"> </span><span class="n">actions</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">python</span><span class="p">@</span><span class="n">v2</span>
<span class="w">      </span><span class="nl">with</span><span class="p">:</span>
<span class="w">        </span><span class="n">python</span><span class="o">-</span><span class="n">version</span><span class="o">:</span><span class="w"> </span><span class="mf">3.8</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">dependencies</span>
<span class="w">      </span><span class="nl">run</span><span class="p">:</span><span class="w"> </span><span class="o">|</span>
<span class="w">        </span><span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">--</span><span class="n">upgrade</span><span class="w"> </span><span class="n">pip</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">requirements</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="p">];</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="n">requirements</span><span class="p">.</span><span class="n">txt</span><span class="p">;</span><span class="w"> </span><span class="n">fi</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">pages</span>
<span class="w">      </span><span class="nl">run</span><span class="p">:</span><span class="w"> </span><span class="o">|</span>
<span class="w">        </span><span class="n">pelican</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">PELICAN_CONFIG_FILE</span><span class="o">:=</span><span class="n">pelicanconf</span><span class="p">.</span><span class="n">py</span><span class="p">}</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">Push</span><span class="w"> </span><span class="n">content</span>
<span class="w">      </span><span class="nl">run</span><span class="p">:</span><span class="w"> </span><span class="o">|</span>
<span class="w">        </span><span class="n">remote_repo</span><span class="o">=</span><span class="s">&quot;https://x-access-token:${{secrets.GITHUB_TOKEN}}@github.com/${GITHUB_REPOSITORY}.git&quot;</span>
<span class="w">        </span><span class="n">remote_branch</span><span class="o">=</span><span class="n">$</span><span class="p">{</span><span class="n">GH_PAGES_BRANCH</span><span class="o">:=</span><span class="n">gh</span><span class="o">-</span><span class="n">pages</span><span class="p">}</span>

<span class="w">        </span><span class="n">cd</span><span class="w"> </span><span class="n">output</span>
<span class="w">        </span><span class="n">git</span><span class="w"> </span><span class="n">init</span>
<span class="w">        </span><span class="n">git</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">-</span><span class="n">A</span>
<span class="w">        </span><span class="n">git</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="s">&quot;${GITHUB_ACTOR}&quot;</span>
<span class="w">        </span><span class="n">git</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="n">email</span><span class="w"> </span><span class="s">&quot;${GITHUB_ACTOR}@users.noreply.github.com&quot;</span>
<span class="w">        </span><span class="n">git</span><span class="w"> </span><span class="n">remote</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">deploy</span><span class="w"> </span><span class="s">&quot;$remote_repo&quot;</span>
<span class="w">        </span><span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="n">$remote_branch</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="o">--</span><span class="n">orphan</span><span class="w"> </span><span class="n">$remote_branch</span>
<span class="w">        </span><span class="n">echo</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Files</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Commit</span><span class="o">:</span><span class="err">&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wc</span><span class="w"> </span><span class="o">-</span><span class="n">l</span>
<span class="w">        </span><span class="n">timestamp</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">date</span><span class="w"> </span><span class="o">+%</span><span class="n">s</span><span class="o">%</span><span class="mi">3</span><span class="n">N</span><span class="p">)</span>
<span class="w">        </span><span class="n">git</span><span class="w"> </span><span class="n">commit</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="s">&quot;[ci skip] Automated deployment to GitHub Pages on $timestamp&quot;</span>
<span class="w">        </span><span class="n">git</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">deploy</span><span class="w"> </span><span class="n">$remote_branch</span><span class="w"> </span><span class="o">--</span><span class="n">force</span>
<span class="w">        </span><span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">fr</span><span class="w"> </span><span class="p">.</span><span class="n">git</span>
<span class="w">        </span><span class="n">cd</span><span class="w"> </span><span class="p">..</span><span class="o">/</span>
<span class="w">        </span><span class="n">echo</span><span class="w"> </span><span class="err">&#39;</span><span class="o">===================</span><span class="w"> </span><span class="n">Done</span><span class="w">  </span><span class="o">===================</span><span class="err">&#39;</span>
</code></pre></div>

<h2>è‡ªåŠ¨æŒç»­é›†æˆ</h2>
<p>åœ¨é…ç½®å®ŒGithub Actionåï¼Œåªéœ€è¦æ“å¿ƒåŸæ–‡æ¡£å­˜æ”¾çš„åˆ†æ”¯ã€‚æ¯æ¬¡æ›´æ–°åŸæ–‡æ¡£åï¼Œæ¨é€åˆ°GitHubä¸Šï¼ŒGitHub Actionsä¼šè‡ªåŠ¨ç¼–è¯‘æ”¹åŠ¨ï¼Œå°†ç»“æœæ›´æ–°åˆ°gh-pagesï¼Œä»è€Œå®ç°äº†åŸæ–‡æ¡£ä¸ç¯å¢ƒã€ç¼–è¯‘è¾“å‡ºæ–‡ä»¶çš„åˆ†ç¦»ã€‚</p>
    </div><!-- /.entry-content -->


  </article>


</section>

<div id="comments">
  <h2 style="margin-top: 0.1rem;">Comments !</h2>
  <div id="gitalk-container"></div>
</div>
<script>
  var gitalk = new Gitalk({
    clientID: '4dfbf5aad180623dc634',
    clientSecret: '4c7167883746062103d9dbc2ec8b1ddfd6780d58',
    repo: 'steermomo.github.io',
    owner: 'steermomo',
    admin: ['steermomo'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false,  // Facebook-like distraction free mode
    createIssueManually: true,
  })
  gitalk.render('gitalk-container')
</script>
        <section id="extras" class="body">
        </section><!-- /#extras -->
<footer id="contentinfo" class="body">
  <address id="about" class="vcard body">
    Copyright Â© 2024
    </br>
    Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a
      href="http://python.org">Python</a>.
  </address>

  <!-- /#about -->


</footer><!-- /#contentinfo -->



</body>

</html>